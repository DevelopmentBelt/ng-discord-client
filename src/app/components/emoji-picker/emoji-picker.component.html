<div 
  *ngIf="isOpen()" 
  class="emoji-picker-overlay"
  (click)="onClose()"
>
  <div 
    class="emoji-picker-container"
    [class.emoji-picker-top]="position() === 'top'"
    [class.emoji-picker-bottom]="position() === 'bottom'"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div class="emoji-picker-header">
      <div class="header-left">
        <h3 class="header-title">Emoji</h3>
        <span class="header-hint">Press Esc to close</span>
      </div>
      <div class="header-right">
        <button 
          class="close-button"
          (click)="onClose()"
          type="button"
          aria-label="Close emoji picker"
          title="Close emoji picker"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
      <div class="search-input-wrapper">
        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        <input
          type="text"
          [value]="searchQuery()"
          (input)="onSearchChange($any($event.target).value)"
          placeholder="Search emojis..."
          class="search-input"
        />
      </div>
      <div class="search-hint">
        ðŸ’¡ Select multiple emojis - click the X when done
      </div>
    </div>

    <!-- Category Tabs -->
    <div class="emoji-picker-categories" *ngIf="!searchQuery()">
      <button
        *ngFor="let category of emojiCategories()"
        class="category-tab"
        [class.active]="selectedCategory() === category.id"
        (click)="onCategorySelect(category.id)"
        type="button"
        [attr.aria-label]="category.name"
        [attr.title]="category.name"
      >
        <span class="category-icon">{{ category.icon }}</span>
      </button>
    </div>

    <!-- Emoji Grid -->
    <div class="emoji-picker-content">
      <div 
        *ngFor="let category of filteredCategories()"
        class="emoji-category"
      >
        <div class="category-header" *ngIf="!searchQuery()">
          <h3 class="category-name">{{ category.name }}</h3>
        </div>
        <div class="emoji-grid">
          <button
            *ngFor="let emoji of category.emojis"
            class="emoji-item"
            (click)="onEmojiSelect(emoji)"
            type="button"
            [attr.aria-label]="emoji.name"
            [attr.title]="emoji.name"
          >
            <span class="emoji-char">{{ emoji.char }}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="emoji-picker-footer">
      <div class="footer-info">
        <span class="footer-text">Select multiple emojis to add to your message</span>
      </div>
      <div class="footer-actions">
        <button 
          class="close-button"
          (click)="onClose()"
          type="button"
          aria-label="Close emoji picker"
        >
          Done
        </button>
      </div>
    </div>
  </div>
</div>
