<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" (keydown)="onKeydown($event)">
  <div class="bg-discord-lighter border border-discord-border rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
    <!-- Modal Header -->
    <div class="px-6 py-4 border-b border-discord-border flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-discord-blue rounded flex items-center justify-center">
          <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-discord-text-lighter">
            {{ isEditing ? 'Edit Channel' : 'Create Channel' }}
          </h3>
          <p class="text-sm text-discord-text-muted">
            {{ isEditing ? 'Modify channel settings' : 'Create a new channel for your server' }}
          </p>
        </div>
      </div>
      <button 
        (click)="close()"
        class="p-2 text-discord-text-muted hover:text-discord-text-light hover:bg-discord-hover rounded transition-colors duration-150"
        title="Close"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>

    <!-- Modal Content -->
    <div class="flex-1 overflow-y-auto px-6 py-4 space-y-6">
      <!-- Basic Information -->
      <div>
        <h4 class="text-sm font-semibold text-discord-text-muted uppercase tracking-wider mb-3">Basic Information</h4>
        <div class="space-y-4">
          <!-- Channel Type -->
          <div>
            <label class="block text-sm font-medium text-discord-text-muted mb-2">Channel Type</label>
            <div class="space-y-2">
              @for (type of channelTypes; track type.value) {
                <label class="flex items-start space-x-3 cursor-pointer">
                  <input 
                    type="radio" 
                    [value]="type.value"
                    [(ngModel)]="channelType"
                    (change)="onChannelTypeChange()"
                    class="w-4 h-4 text-discord-blue focus:ring-discord-blue border-discord-border"
                  />
                  <div class="flex-1">
                    <span class="text-discord-text-light font-medium">{{ type.label }}</span>
                    <p class="text-sm text-discord-text-muted">{{ type.description }}</p>
                  </div>
                </label>
              }
            </div>
          </div>

          <!-- Channel Name -->
          <div>
            <label class="block text-sm font-medium text-discord-text-muted mb-2">Channel Name</label>
            <div class="flex items-center space-x-2">
              <span class="text-discord-text-muted">#</span>
              <input 
                type="text" 
                [(ngModel)]="channelName"
                class="flex-1 bg-discord-light text-discord-text-light border border-discord-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-discord-blue/50 transition-all duration-200"
                placeholder="new-channel"
                maxlength="100"
              />
            </div>
            <p class="text-xs text-discord-text-muted mt-1">Channel names can only contain lowercase letters, numbers, and hyphens</p>
          </div>

          <!-- Category Selection -->
          @if (supportsCategorySelection()) {
            <div>
              <label class="block text-sm font-medium text-discord-text-muted mb-2">Category</label>
              <select 
                [(ngModel)]="selectedCategory"
                class="w-full bg-discord-light text-discord-text-light border border-discord-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-discord-blue/50"
              >
                <option value="">No Category</option>
                @for (category of getAvailableCategories(); track category.id) {
                  <option [value]="category.id">{{ category.name }}</option>
                }
              </select>
              <p class="text-xs text-discord-text-muted mt-1">Choose a category to organize this channel</p>
            </div>
          }
        </div>
      </div>

      <!-- Channel Settings -->
      @if (channelType() !== 'category') {
        <div>
          <h4 class="text-sm font-semibold text-discord-text-muted uppercase tracking-wider mb-3">Channel Settings</h4>
          <div class="space-y-4">
            <!-- Topic (Text channels only) -->
            @if (supportsTopic()) {
              <div>
                <label class="block text-sm font-medium text-discord-text-muted mb-2">Topic</label>
                <textarea 
                  [(ngModel)]="channelTopic"
                  rows="3"
                  class="w-full bg-discord-light text-discord-text-light border border-discord-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-discord-blue/50 transition-all duration-200"
                  placeholder="What is this channel about?"
                  maxlength="1024"
                ></textarea>
                <p class="text-xs text-discord-text-muted mt-1">Let people know what this channel is for</p>
              </div>
            }

            <!-- NSFW Toggle -->
            <div>
              <label class="flex items-center space-x-3 cursor-pointer">
                <input 
                  type="checkbox" 
                  [(ngModel)]="isNsfw"
                  class="w-4 h-4 text-discord-blue focus:ring-discord-blue border-discord-border rounded"
                />
                <div>
                  <span class="text-discord-text-light font-medium">Age-restricted channel (NSFW)</span>
                  <p class="text-sm text-discord-text-muted">This channel contains age-restricted content</p>
                </div>
              </label>
            </div>

            <!-- Slowmode (Text channels only) -->
            @if (supportsSlowmode()) {
              <div>
                <label class="block text-sm font-medium text-discord-text-muted mb-2">Slowmode</label>
                <select 
                  [(ngModel)]="slowmode"
                  class="w-full bg-discord-light text-discord-text-light border border-discord-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-discord-blue/50"
                >
                  @for (option of slowmodeOptions; track option.value) {
                    <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
                <p class="text-xs text-discord-text-muted mt-1">Set a delay between messages sent by each user</p>
              </div>
            }

            <!-- User Limit (Voice channels only) -->
            @if (supportsUserLimit()) {
              <div>
                <label class="block text-sm font-medium text-discord-text-muted mb-2">User Limit</label>
                <input 
                  type="number" 
                  [(ngModel)]="userLimit"
                  min="0"
                  max="99"
                  class="w-full bg-discord-light text-discord-text-light border border-discord-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-discord-blue/50 transition-all duration-200"
                  placeholder="0 (no limit)"
                />
                <p class="text-xs text-discord-text-muted mt-1">Maximum number of users that can join this voice channel (0 = no limit)</p>
              </div>
            }

            <!-- Bitrate (Voice channels only) -->
            @if (supportsBitrate()) {
              <div>
                <label class="block text-sm font-medium text-discord-text-muted mb-2">Bitrate</label>
                <select 
                  [(ngModel)]="bitrate"
                  class="w-full bg-discord-light text-discord-text-light border border-discord-border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-discord-blue/50"
                >
                  @for (option of bitrateOptions; track option.value) {
                    <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
                <p class="text-xs text-discord-text-muted mt-1">Audio quality for this voice channel</p>
              </div>
            }
          </div>
        </div>
      }
    </div>

    <!-- Modal Footer -->
    <div class="px-6 py-4 border-t border-discord-border flex items-center justify-end space-x-3">
      <button 
        (click)="close()"
        class="px-4 py-2 bg-discord-medium hover:bg-discord-hover text-discord-text-light font-medium rounded-md transition-colors duration-150"
      >
        Cancel
      </button>
      <button 
        (click)="save()"
        class="px-4 py-2 bg-discord-blue hover:bg-discord-blue-dark text-white font-medium rounded-md transition-colors duration-150"
      >
        {{ isEditing ? 'Save Changes' : 'Create Channel' }}
      </button>
    </div>
  </div>
</div>
