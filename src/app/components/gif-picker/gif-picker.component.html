@if (isOpen()) {
  <div class="gif-picker-overlay" (click)="onClose()">
    <div 
      class="gif-picker-container"
      [class.position-top]="position() === 'top'"
      [class.position-bottom]="position() === 'bottom'"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="gif-picker-header">
        <div class="header-left">
          <h3 class="header-title">GIFs</h3>
          <span class="header-hint">Press Esc to close</span>
        </div>
        <div class="header-right">
          <button 
            class="close-button"
            (click)="onClose()"
            type="button"
            aria-label="Close GIF picker"
            title="Close GIF picker"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="search-container">
        <div class="search-input-wrapper">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
          </svg>
          <input
            type="text"
            [value]="searchQuery()"
            (input)="onSearchChange($any($event.target).value)"
            placeholder="Search GIFs..."
            class="search-input"
          />
        </div>
        <div class="search-hint">
          ðŸ’¡ Select multiple GIFs - click the X when done
        </div>
      </div>

      <!-- Categories -->
      <div class="gif-picker-categories">
        @for (category of filteredCategories(); track category.id) {
          <button
            class="category-tab"
            [class.active]="selectedCategory() === category.id"
            (click)="onCategorySelect(category.id)"
            type="button"
            [title]="category.name"
          >
            <img 
              [src]="category.previewUrl" 
              [alt]="category.name"
              class="category-preview"
              loading="lazy"
            />
            <span class="category-name">{{ category.name }}</span>
          </button>
        }
      </div>

      <!-- GIF Grid -->
      <div class="gif-grid-container">
        @if (isLoading()) {
          <div class="loading-container">
            <div class="loading-spinner"></div>
            <span class="loading-text">Loading GIFs...</span>
          </div>
        } @else {
          <div class="gif-grid">
            @for (gif of getCurrentGifs(); track gif.id) {
              <div 
                class="gif-item"
                [attr.data-gif-id]="gif.id"
                (click)="onGifSelect(gif)"
                [title]="gif.title"
              >
                <img 
                  [src]="gif.previewUrl" 
                  [alt]="gif.title"
                  class="gif-preview"
                  loading="lazy"
                />
                <div class="gif-overlay">
                  <span class="gif-title">{{ gif.title }}</span>
                </div>
              </div>
            }
          </div>
          
          @if (getCurrentGifs().length === 0 && searchQuery().trim()) {
            <div class="no-results">
              <span class="no-results-text">No GIFs found for "{{ searchQuery() }}"</span>
              <span class="no-results-hint">Try a different search term</span>
            </div>
          }
        }
      </div>

      <!-- Footer -->
      <div class="gif-picker-footer">
        <div class="footer-info">
          <span class="footer-text">Select multiple GIFs to add to your message</span>
        </div>
        <div class="footer-actions">
          <button 
            class="close-button"
            (click)="onClose()"
            type="button"
            aria-label="Close GIF picker"
          >
            Done
          </button>
        </div>
      </div>
    </div>
  </div>
}
